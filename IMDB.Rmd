---
title: "Predicting IMBD Scores"
author: "Shivani Dedhia, Akhila Pamukuntla, Nafis Chowdhury, Akshita Jain"
output: 
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE , dev = "png", dpi=300)
options(digits = 2)

library(readr)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(stringr)
library(ggrepel)
library(reshape2)
library(corrgram)
library(tree)
library(rpart)
library(rpart.plot)
library(randomForest)
library(plotly)
```

# STA 9750 Final Project

## Introduction

###### Many factors make a movie succesful and profitable. Some of the factors include budget of the movie, actor's and director's popularity, etc. We will find out which factor has the most impact on the movies success and profitability.  

###### We have the IMDB 5000 movie dataset, which has 28 variables, 5043 movies across 100 years in 66 countries. There are many varibles in the dataset such as Director, Actors, Duration, Gross, Budget, Genres, Facebook Likes, etc. 

## Hypothesis

```{r combine and clean data, warning=FALSE, include=FALSE}
IMDB <- read.csv("IMDM_ratings.csv")

imdb <- IMDB[!duplicated(IMDB), ]
imdb <- imdb[!is.na(imdb$gross), ]
imdb <- imdb[!is.na(imdb$budget), ]

imdb <- subset(imdb, select = -c(aspect_ratio))
imdb <- subset(imdb, select = -c(color))
imdb <- subset(imdb, select = -c(movie_imdb_link))
imdb <- subset(imdb, select = -c(language))

# Cleaning the movie title by removing the special character "Â" at the end and some whitespaces.
imdb$movie_title <- gsub("Â", "", as.character(factor(imdb$movie_title)))
clean_title <- str_trim(imdb$movie_title, side = "right")

# Adding profit and ROI
imdb <- imdb %>% mutate(net_profit = gross - budget,return_on_investment = (net_profit/budget)*100)

# replacing all NA's with col average
imdb$facenumber_in_poster[is.na(imdb$facenumber_in_poster)] <- round(mean(imdb$facenumber_in_poster, na.rm = TRUE))

# replacing all 0's with NA's
imdb[,c(5,6,8,13,24,26)][imdb[,c(5,6,8,13,24,26)] == 0] <- NA

# replacing all NA's with col average
imdb$num_critic_for_reviews[is.na(imdb$num_critic_for_reviews)] <- round(mean(imdb$num_critic_for_reviews, na.rm = TRUE))
imdb$duration[is.na(imdb$duration)] <- round(mean(imdb$duration, na.rm = TRUE))
imdb$director_facebook_likes[is.na(imdb$director_facebook_likes)] <- round(mean(imdb$director_facebook_likes, na.rm = TRUE))
imdb$actor_3_facebook_likes[is.na(imdb$actor_3_facebook_likes)] <- round(mean(imdb$actor_3_facebook_likes, na.rm = TRUE))
imdb$actor_1_facebook_likes[is.na(imdb$actor_1_facebook_likes)] <- round(mean(imdb$actor_1_facebook_likes, na.rm = TRUE))
imdb$cast_total_facebook_likes[is.na(imdb$cast_total_facebook_likes)] <- round(mean(imdb$cast_total_facebook_likes, na.rm = TRUE))
imdb$actor_2_facebook_likes[is.na(imdb$actor_2_facebook_likes)] <- round(mean(imdb$actor_2_facebook_likes, na.rm = TRUE))
imdb$movie_facebook_likes[is.na(imdb$movie_facebook_likes)] <- round(mean(imdb$movie_facebook_likes, na.rm = TRUE))

# delete the blank cols in content rating as they cannot be replaced with anything reasonable
imdb <- imdb[!(imdb$content_rating %in% ""),]

# replacing all content_rating with mordern rating system
imdb$content_rating[imdb$content_rating == 'M']   <- 'PG' 
imdb$content_rating[imdb$content_rating == 'GP']  <- 'PG' 
imdb$content_rating[imdb$content_rating == 'X']   <- 'NC-17'
imdb$content_rating[imdb$content_rating == 'Approved']  <- 'R' 
imdb$content_rating[imdb$content_rating == 'Not Rated'] <- 'R' 
imdb$content_rating[imdb$content_rating == 'Passed']    <- 'R' 
imdb$content_rating[imdb$content_rating == 'Unrated']   <- 'R' 
imdb$content_rating <- factor(imdb$content_rating)

levels(imdb$country) <- c(levels(imdb$country), "Others")
imdb$country[(imdb$country != 'USA')&(imdb$country != 'UK')] <- 'Others' 
imdb$country <- factor(imdb$country)
```

## Data Exploration

###### After exploring the data variables such as languages, aspect ratio, imdb movie link and color were removed to reduce bias. As many of these variables had data heavily skewed on one side. 

## Imdb score distribution

```{r score_distribution, warning=FALSE, include=FALSE}

ggplot(aes(x=imdb_score), data = imdb) +
  geom_histogram(binwidth = 0.2,aes(fill = ..count..)) +
  scale_x_continuous(breaks = 0:10) +
  ggtitle("Imdb Score Distribution") +
  labs(x = "IMDB Score", y = "Count of Movies")

```
###### Count of movies rated above 7.5 which are considered to be highly recommended

###### Majority of the movies are rated 7.6 with only a handful rated above 9. The highest rating recieved by one movie is 9.3. This shows there is not enough data to understand the variables that have the strongest impact on highly rated movies.

```{r imdb_score_table, warning=FALSE, include=FALSE}

imdb %>% group_by(imdb_score) %>% filter(imdb_score > 7.5) %>% count(imdb_score) %>% arrange(desc(n))

```
###### Average Imdb Score by Content Rating

###### Average score for movies by content rating is below 6.6 which is considered a poor imdb score. As per this distribution content rating does not have a strong impact on the imdb score.
```{r content_rating chart, warning=FALSE, include=FALSE}

rating_imdb <- imdb %>% group_by(content_rating) %>%
  filter(!is.na(content_rating)) %>%
  summarise(average_imdb_score = mean(imdb_score), num = n())

  ggplot(aes(x=average_imdb_score, y = num, label = content_rating),data = rating_imdb) +
  geom_point() +
  geom_label_repel()

```
###### Understanding the distribution of directors and their effect on IMDB score

###### Directors have been grouped by the number of movies directed. The data has been filtered to only show movies directed above  10 and below 50 remove any anomalies in the data. Directors with more movies could have a higher fan following, credibility and success rate possibly leading to a higher imdb score. 

```{r directors, warning=FALSE, include=FALSE}

imdb.directors <- data.frame (imdb %>% 
                                  group_by(director_name) %>%
                                  summarise(count = n())%>%
                                  filter(count >10, count <50))

ggplot(aes(x = director_name, y = count), data = imdb.directors)+
  geom_jitter() +
  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5)) +
  labs(title="Directors Distribution on Movies",x="Directors",y="Count of Movies")


```
###### Only a handful of directors have over 15 movies directed in this data set. Steven Spielberg is the only director to have ~ 24 movies directed. The chart below shows average imdb score for directors with 15 or more directed movies. The imdb score is above 5.5 for directors with more than 15 movies. 

###### Most directors have recieved a higher imdb score that shows the number of movies directed has a slight impact on the imdb score.

```{r score by director, warning=FALSE, include=FALSE}

avg_score_per_director <- data.frame (imdb %>% 
                                  group_by(director_name) %>%
                                  mutate(count = n(),average_imdb_score = mean(imdb_score))%>%
                                  filter(count >14, count <50))
                                  
  

ggplot(aes(x = director_name, y = average_imdb_score), data = avg_score_per_director)+
  geom_point() +
  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5)) +
  labs(title="Average Imdb Score by Director",x="Directors",y="Average Imdb Score")

```

###### Impact of movie duration for a higher imdb score

###### The average imdb score is shown compared to the duration of the movie. The duration of the movie increases as the imdb score increases. Duration of the movie is not a strong determinator of the imdb score but has a slight impact on the score. The number of movies rated above 7 increases as the movie duration increases.

```{r movie duration, warning=FALSE, include=FALSE}

ggplot(imdb, aes(x =imdb_score, y =duration,colour = factor(imdb_score)))+
  geom_point() +
  labs(title = "Movie Duration and IMDB score", 
       x = "Imdb Score", y = "Duration") 
```
###### Impact of net profit on imdb score.

###### Movies with a net profit over 200 million has a higher imdb rating. Net profit is one of the strong indicators of a higher imdb score. As the trend below shows higher net profits translates to a higher rating, It could be assumed that the viewrship for movies with higher net profits was higher thus recieved a higher movie rating. 

```{r net profit, warning=FALSE}

ggplot(aes(x = imdb_score, y=net_profit/1000000 ), data = subset(imdb, net_profit > 1, !is.na(net_profit))) +
  geom_jitter() +
  geom_smooth() +
  labs(title = "Net Profit and IMDB score", 
       x = " Imdb Score", y = "Net Profit in $ Million") 

```


